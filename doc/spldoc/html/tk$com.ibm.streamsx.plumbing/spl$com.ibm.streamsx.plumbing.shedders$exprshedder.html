<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en-us" lang="en-us">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2005"/>
<meta name="DC.rights.owner" content="(C) Copyright 2005"/>
<meta name="DC.Type" content="reference"/>
<meta name="DC.Title" content="SPL File exprshedder.spl"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="spldoc_compilationunit"/>
<link rel="stylesheet" type="text/css" href="../../html/commonltr.css"/>
<link rel="stylesheet" type="text/css" href="../../html/spldoc.css"/>
<title>SPL File exprshedder.spl</title>
</head>
<body id="spldoc_compilationunit">


<h1 class="title topictitle1">SPL File <tt class="ph tt">exprshedder.spl</tt></h1>

<div class="body refbody">
<div class="section">
<p class="p">
<a class="xref" href="../toolkits/toolkits.html">com.ibm.streamsx.plumbing</a> &gt; <a class="xref" href="tk$com.ibm.streamsx.plumbing.html">com.ibm.streamsx.plumbing 1.0.0</a> &gt; <a class="xref" href="ns$com.ibm.streamsx.plumbing.shedders.html">com.ibm.streamsx.plumbing.shedders</a> &gt; exprshedder.spl</p>

</div>

<div class="section"><h2 class="title sectiontitle splhead-1">Content</h2>
  
  <dl class="dl">
    <dt class="dt dlterm"/>
<dd class="dd"/>

    
      <dt class="dt dlterm splhead-2">Operators</dt>

      <dd class="dd">
<ul class="sl simple">
<li class="sli"><strong class="ph b"><a class="xref" href="spl$com.ibm.streamsx.plumbing.shedders$exprshedder.html#spldoc_compilationunit__composite_operator__ExpressionLoadShedder">ExpressionLoadShedder</a></strong>: Controllable load shedder that sheds (drops) tuples based upon evaluating an expression.
</li>

</ul>

      </dd>

    
    
      <dt class="dt dlterm splhead-2">Functions</dt>

      <dd class="dd">
<ul class="sl simple">
<li class="sli"><strong class="ph b"><a class="xref" href="spl$com.ibm.streamsx.plumbing.shedders$exprshedder.html#spldoc_compilationunit__function__getExpressionShedderMode.rstring">getExpressionShedderMode(rstring)</a></strong>: Get the shedding mode for <a class="xref" href="spl$com.ibm.streamsx.plumbing.shedders$exprshedder.html#spldoc_compilationunit__composite_operator__ExpressionLoadShedder">ExpressionLoadShedder</a> operator invocations using control variable <tt class="ph tt">name</tt>.
</li>

<li class="sli"><strong class="ph b"><a class="xref" href="spl$com.ibm.streamsx.plumbing.shedders$exprshedder.html#spldoc_compilationunit__function__registerExpressionShedder.rstring">registerExpressionShedder(rstring)</a></strong>: Register that an operator invocation will call <a class="xref" href="spl$com.ibm.streamsx.plumbing.shedders$exprshedder.html#spldoc_compilationunit__function__setExpressionShedderMode.rstring.boolean">setExpressionShedderMode(rstring, boolean)</a> or <a class="xref" href="spl$com.ibm.streamsx.plumbing.shedders$exprshedder.html#spldoc_compilationunit__function__getExpressionShedderMode.rstring">getExpressionShedderMode(rstring)</a>.
</li>

<li class="sli"><strong class="ph b"><a class="xref" href="spl$com.ibm.streamsx.plumbing.shedders$exprshedder.html#spldoc_compilationunit__function__setExpressionShedderMode.rstring.boolean">setExpressionShedderMode(rstring, boolean)</a></strong>: Set the shedding mode for <a class="xref" href="spl$com.ibm.streamsx.plumbing.shedders$exprshedder.html#spldoc_compilationunit__composite_operator__ExpressionLoadShedder">ExpressionLoadShedder</a> operator invocations  using control variable <tt class="ph tt">name</tt>.
</li>

</ul>

      </dd>

    
  </dl>

</div>

<div class="section"><h2 class="title sectiontitle splhead-1">Composites</h2>
  
</div>

<div class="section" id="spldoc_compilationunit__composite_operator__ExpressionLoadShedder"><h2 class="title sectiontitle splpart">composite ExpressionLoadShedder(output Out; input In)</h2>
  
</div>

<div class="section splgraph">
  <embed class="image" src="../../image/tk$com.ibm.streamsx.plumbing/op$com.ibm.streamsx.plumbing.shedders$ExpressionLoadShedder.svg" width="142" height="109"/>
</div>

<div class="section">

<p class="p">Controllable load shedder that sheds (drops) tuples based upon evaluating an expression. Tuple that are not shed are copied from the input port to the output port without modification. Punctuation marks are always forwarded from <tt class="ph tt">In</tt> to <tt class="ph tt">Out</tt>.
</p>

<p class="p">This operator creates a <tt class="ph tt">boolean</tt> control variable named <tt class="ph tt">name</tt>. Initially the variable is set to <tt class="ph tt">false</tt> which means no tuples will be shed. If the variable is changed to <tt class="ph tt">true</tt> then tuples will be shed. The selection of tuples to shed is defined by <tt class="ph tt">expr</tt>. If 
</p>

<p class="p">The control variable may be shared across multiple invocations of <tt class="ph tt">ExpreessionLoadShedder</tt>, by invoking them with the same value for <tt class="ph tt">name</tt>. <tt class="ph tt">name</tt> is scoped to the job.
</p>

<p class="p">The shedding mode is changed by calling the function <a class="xref" href="spl$com.ibm.streamsx.plumbing.shedders$exprshedder.html#spldoc_compilationunit__function__setExpressionShedderMode.rstring.boolean">setExpressionShedderMode(rstring, boolean)</a> from any operator in same job. Thus the logic that determines the shedding mode does not define a stream connection to this operator, instead the Job Control Plane, through the the control variable, provides the control mechanism. When the job is first submitted the shedding mode is set to <tt class="ph tt">false</tt>, so no tuples will be shed. Upon any failure, the shedding is maintained by the control variable.
</p>

<p class="p">Java primitive operators may also change the shedding mode by modifying the control variable using functionality in the <tt class="ph tt">com.ibm.streams.operator.control.variable</tt> package.
</p>

<p class="p">Multiple <tt class="ph tt">ExpressionLoadShedder</tt> operator may share the same control variable, by being invoked with the same value for the <tt class="ph tt">name</tt> parameter.
</p>

<p class="p">Any application that invokes this operator must include a single invocation of the <tt class="ph tt">spl.control::JobControlPlane</tt> operator.
</p>

</div>

<div class="section"><h2 class="title sectiontitle">Parameters</h2>

<ul class="sl simple">
<li class="sli"><strong class="ph b">name</strong>: Name of the control variable for this operator invocation.
</li>

<li class="sli"><strong class="ph b">expr</strong>: Expression evaluated against each tuple when in shedding mode. 
</li>

</ul>

</div>

<div class="section"><h2 class="title sectiontitle">Input Ports</h2>

<ul class="sl simple">
<li class="sli"><strong class="ph b">In</strong>: Port containing tuples that will be copied to the output if they not shed.
</li>

</ul>

</div>

<div class="section"><h2 class="title sectiontitle">Output Ports</h2>

<ul class="sl simple">
<li class="sli"><strong class="ph b">Out</strong>: Port containing tuples from <tt class="ph tt">In</tt> that were not shed.
</li>

</ul>

</div>

<div class="section"><h2 class="title sectiontitle splhead-2">SPL Source Code</h2>
  
</div>


<div class="section">
   <pre class="pre codeblock">

 public composite ExpressionLoadShedder(input In ; output Out)
 {
 	param
 		expression&lt;rstring&gt; $name ;
 		expression&lt;boolean&gt; $expr ;
 	graph
 
 		(stream&lt;In&gt; Out) as LoadShedder = Custom(In)
 		{
 			logic
 				state :
 				{
 				    rstring _name = $name;
 					boolean __unused = __initExpressionShedder(_name) ;
 					mutable boolean currentShed = false;
 				}
 
 				onTuple In :
 				{
 				    boolean shed = getExpressionShedderMode(_name);
 					if(!shed)
 					{
 						submit(In, Out) ;
 					}
 					else if (!($expr))
 					{
 					   submit(In, Out) ;
 					}
 					
 					if (shed != currentShed) {
 					    setCustomMetricValue("shedding", shed ? 1l : 0l) ;
 					    currentShed = shed;
 					}
 
 				}
 			}
 }

   </pre>

</div>

<div class="section"><h2 class="title sectiontitle splhead-1">Functions</h2>
  
</div>

<div class="section" id="spldoc_compilationunit__function__registerExpressionShedder.rstring"><h2 class="title sectiontitle splpart">boolean registerExpressionShedder(rstring name)</h2>
  
</div>
<div class="section">

<p class="p">Register that an operator invocation will call <a class="xref" href="spl$com.ibm.streamsx.plumbing.shedders$exprshedder.html#spldoc_compilationunit__function__setExpressionShedderMode.rstring.boolean">setExpressionShedderMode(rstring, boolean)</a> or <a class="xref" href="spl$com.ibm.streamsx.plumbing.shedders$exprshedder.html#spldoc_compilationunit__function__getExpressionShedderMode.rstring">getExpressionShedderMode(rstring)</a>. A  shared<tt class="ph tt">boolean</tt> control variable is created with name <tt class="ph tt">name</tt>.
</p>

<p class="p">This function must be called in the <tt class="ph tt">logic state</tt> section of any operator invocation that calls <tt class="ph tt">setExpressionShedderMode</tt> or <tt class="ph tt">getExpressionShedderMode</tt>.
</p>

</div>

<div class="section"><h2 class="title sectiontitle">Parameters</h2>

 <ul class="sl simple">
   <li class="sli">
<strong class="ph b">name</strong>
   </li>

 </ul>

</div>

<div class="section"><h2 class="title sectiontitle">Returns</h2>

<ul class="sl simple"><li class="sli">
<tt class="ph tt">true</tt></li>
</ul>

</div>

<div class="section"><h2 class="title sectiontitle splhead-2">SPL Source Code</h2>
  
</div>

<div class="section">
   <pre class="pre codeblock">

 public stateful boolean registerExpressionShedder(rstring name)
 {
 	createBooleanControlVariable(name, true, false) ;
 	return true ;
 }

   </pre>

</div>

<div class="section" id="spldoc_compilationunit__function__setExpressionShedderMode.rstring.boolean"><h2 class="title sectiontitle splpart">void setExpressionShedderMode(rstring name, boolean shed)</h2>
  
</div>
<div class="section">

<p class="p">Set the shedding mode for <a class="xref" href="spl$com.ibm.streamsx.plumbing.shedders$exprshedder.html#spldoc_compilationunit__composite_operator__ExpressionLoadShedder">ExpressionLoadShedder</a> operator invocations  using control variable <tt class="ph tt">name</tt>. If <tt class="ph tt">shed</tt> is <tt class="ph tt">false</tt>, then no tuples will be shed. If <tt class="ph tt">shed</tt> is <tt class="ph tt">true</tt> then any tuple that evaluates the operator invocation's expression to <tt class="ph tt">true</tt> will be shed
</p>

<p class="p">Any operator that invokes this must call <a class="xref" href="spl$com.ibm.streamsx.plumbing.shedders$exprshedder.html#spldoc_compilationunit__function__registerExpressionShedder.rstring">registerExpressionShedder(rstring)</a> in its <tt class="ph tt">logic state</tt> section, passing the same value for <tt class="ph tt">name</tt>. Any operator may invoke this method to control <a class="xref" href="spl$com.ibm.streamsx.plumbing.shedders$exprshedder.html#spldoc_compilationunit__composite_operator__ExpressionLoadShedder">ExpressionLoadShedder</a> operator invocations within the same job, that were invoked with their parameter <tt class="ph tt">name</tt> set to <tt class="ph tt">name</tt>.
</p>

</div>

<div class="section"><h2 class="title sectiontitle">Parameters</h2>

 <ul class="sl simple">
   <li class="sli">
<strong class="ph b">name</strong>: Name of the variable for the <tt class="ph tt">ExpressionLoadShedder</tt> operator invocation(s).
   </li>

   <li class="sli">
<strong class="ph b">shed</strong>: <tt class="ph tt">true</tt> to set <a class="xref" href="spl$com.ibm.streamsx.plumbing.shedders$exprshedder.html#spldoc_compilationunit__composite_operator__ExpressionLoadShedder">ExpressionLoadShedder</a> invocations to shed tuples, <tt class="ph tt">false</tt> to stop shedding.
   </li>

 </ul>

</div>

<div class="section">
</div>

<div class="section"><h2 class="title sectiontitle splhead-2">SPL Source Code</h2>
  
</div>

<div class="section">
   <pre class="pre codeblock">

 public stateful void setExpressionShedderMode(rstring name, boolean shed)
 {
 	setBooleanControlVariable(name, shed) ;
 }

   </pre>

</div>

<div class="section" id="spldoc_compilationunit__function__getExpressionShedderMode.rstring"><h2 class="title sectiontitle splpart">boolean getExpressionShedderMode(rstring name)</h2>
  
</div>
<div class="section">

<p class="p">Get the shedding mode for <a class="xref" href="spl$com.ibm.streamsx.plumbing.shedders$exprshedder.html#spldoc_compilationunit__composite_operator__ExpressionLoadShedder">ExpressionLoadShedder</a> operator invocations using control variable <tt class="ph tt">name</tt>.
</p>

<p class="p">Any operator that invokes this must call <a class="xref" href="spl$com.ibm.streamsx.plumbing.shedders$exprshedder.html#spldoc_compilationunit__function__registerExpressionShedder.rstring">registerExpressionShedder(rstring)</a> in its <tt class="ph tt">logic state</tt> section, passing the same value for <tt class="ph tt">name</tt>.
</p>

</div>

<div class="section"><h2 class="title sectiontitle">Parameters</h2>

 <ul class="sl simple">
   <li class="sli">
<strong class="ph b">name</strong>: Name of the variable for the <tt class="ph tt">ExpressionLoadShedder</tt> operator invocation(s).
   </li>

 </ul>

</div>

<div class="section"><h2 class="title sectiontitle">Returns</h2>

<ul class="sl simple"><li class="sli">
<tt class="ph tt">boolean</tt>
</li>
</ul>

</div>

<div class="section"><h2 class="title sectiontitle splhead-2">SPL Source Code</h2>
  
</div>

<div class="section">
   <pre class="pre codeblock">

 public boolean getExpressionShedderMode(rstring name)
 {
 	return getBooleanControlVariable(name) ;
 }

   </pre>

</div>

</div>


</body>
</html>